{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "BrikByte Container Tag Policy Evidence (v1)",
  "type": "object",
  "required": ["schema", "timestamp", "inputs", "detected", "resolved", "verdict", "failure_reasons"],
  "properties": {
    "schema": { "type": "string", "const": "brikbyte.audit.container-tag-policy.v1" },
    "timestamp": { "type": "string" },

    "inputs": {
      "type": "object",
      "required": ["push", "tags_input", "allow_latest", "release", "enforce_tag_policy"],
      "properties": {
        "push": { "type": "boolean" },
        "tags_input": { "type": "string" },
        "allow_latest": { "type": "boolean" },
        "release": { "type": "boolean" },
        "semver_override": { "type": ["string", "null"] },
        "sha_override": { "type": "boolean" },
        "enforce_tag_policy": { "type": "boolean" }
      },
      "additionalProperties": true
    },

    "detected": {
      "type": "object",
      "required": ["is_release", "detected_sha_tag", "detected_semver_tag", "has_latest"],
      "properties": {
        "is_release": { "type": "boolean" },
        "sha_source": { "type": ["string", "null"] },
        "detected_sha_tag": { "type": ["string", "null"] },
        "detected_semver_tag": { "type": ["string", "null"] },
        "has_latest": { "type": "boolean" }
      },
      "additionalProperties": true
    },

    "resolved": {
      "type": "object",
      "required": ["tags_resolved"],
      "properties": {
        "tags_resolved": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "verdict": { "type": "string", "enum": ["pass", "fail", "warn"] },

    "failure_reasons": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["code", "message", "fix"],
        "properties": {
          "code": { "type": "string" },
          "message": { "type": "string" },
          "fix": { "type": "string" }
        }
      }
    },

    "notices": {
      "type": "array",
      "items": { "type": "object" }
    }
  },
  "additionalProperties": true
}
